<div class="container mt-4" style="margin-bottom: 30px">
  <div
    *ngIf="successMessage"
    class="alert alert-success alert-dismissible fade show"
    role="alert"
  >
    {{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="Close"></button>
  </div>

  <h2 class="mb-4">Update Cases</h2>

  <div *ngIf="loading">Loading cases...</div>

  <div *ngIf="!loading && cases.length === 0" class="alert alert-info">No cases found.</div>

  <article *ngFor="let caseItem of cases" class="card mb-3">
    <div class="card-body">
      <ng-container *ngIf="editingCaseId !== caseItem._id; else editForm">
        <h3 class="card-title">{{ caseItem.case_title }}</h3>
        <p class="card-text mb-2"><b>Handler:</b> {{ caseItem.case_handler }}</p>
        <p class="card-text mb-2">
          <b>Date:</b> {{ caseItem.case_date | date: 'dd-MM-yyyy' }}
        </p>
        <p class="card-text mb-2"><b>Status:</b> {{ caseItem.status }}</p>
        <p class="card-text mb-2">{{ caseItem.case_description?.substring(0, 150) }}...</p>
        <button class="btn btn-warning mt-2" (click)="handleEditClick(caseItem)">Update</button>
      </ng-container>
      <ng-template #editForm>
        <form (ngSubmit)="onSubmit()" novalidate>
          <p>
            <b>Title:</b>
            <input
              type="text"
              name="case_title"
              [(ngModel)]="formData.case_title"
              class="form-control"
              [class.error]="errors.case_title"
            />
            <label *ngIf="errors.case_title" class="error">{{ errors.case_title }}</label>
          </p>

          <p>
            <b>Type:</b>
            <select
              name="case_type"
              [(ngModel)]="formData.case_type"
              class="form-select"
              [class.error]="errors.case_type"
            >
              <option value="">Select Case Type</option>
              <option value="Homicide (Murder)">Homicide (Murder)</option>
              <option value="Manslaughter">Manslaughter</option>
              <option value="Rape / Sexual Assault">Rape / Sexual Assault</option>
              <option value="Kidnapping / Abduction">Kidnapping / Abduction</option>
              <option value="Aggravated Assault">Aggravated Assault</option>
              <option value="Simple Assault / Battery">Simple Assault / Battery</option>
              <option value="Robbery">Robbery</option>
              <option value="Burglary / House Breaking">Burglary / House Breaking</option>
              <option value="Theft (Larceny)">Theft (Larceny)</option>
              <option value="Motor Vehicle Theft">Motor Vehicle Theft</option>
              <option value="Vandalism / Criminal Damage">Vandalism / Criminal Damage</option>
              <option value="Extortion / Blackmail">Extortion / Blackmail</option>
              <option value="Cybercrime / Hacking">Cybercrime / Hacking</option>
              <option value="Fraud / Cheating">Fraud / Cheating</option>
              <option value="Forgery / Counterfeiting">Forgery / Counterfeiting</option>
              <option value="Embezzlement / Breach of Trust">Embezzlement / Breach of Trust</option>
              <option value="Money Laundering">Money Laundering</option>
              <option value="Drug Offense (NDPS)">Drug Offense (NDPS)</option>
              <option value="Smuggling / Contraband">Smuggling / Contraband</option>
              <option value="Illegal Weapons">Illegal Weapons</option>
              <option value="Illegal Gambling">Illegal Gambling</option>
              <option value="Public Order / Rioting">Public Order / Rioting</option>
              <option value="Domestic Violence">Domestic Violence</option>
              <option value="Missing Person Report">Missing Person Report</option>
              <option value="Traffic Accident (Non-Fatal)">Traffic Accident (Non-Fatal)</option>
            </select>
            <label *ngIf="errors.case_type" class="error">{{ errors.case_type }}</label>
          </p>

          <p>
            <b>Description:</b>
            <textarea
              name="case_description"
              [(ngModel)]="formData.case_description"
              class="form-control"
              [class.error]="errors.case_description"
            ></textarea>
            <label *ngIf="errors.case_description" class="error">{{ errors.case_description }}</label>
          </p>

          <p>
            <b>Suspects:</b>
            <input
              type="text"
              name="suspects"
              [(ngModel)]="formData.suspects"
              class="form-control"
              [class.error]="errors.suspects"
            />
            <label *ngIf="errors.suspects" class="error">{{ errors.suspects }}</label>
          </p>
          <p>
            <b>Victim:</b>
            <input
              type="text"
              name="victim"
              [(ngModel)]="formData.victim"
              class="form-control"
              [class.error]="errors.victim"
            />
            <label *ngIf="errors.victim" class="error">{{ errors.victim }}</label>
          </p>
          <p>
            <b>Guilty Name:</b>
            <input
              type="text"
              name="guilty_name"
              [(ngModel)]="formData.guilty_name"
              class="form-control"
              [class.error]="errors.guilty_name"
            />
            <label *ngIf="errors.guilty_name" class="error">{{ errors.guilty_name }}</label>
          </p>

          <p>
            <b>Date:</b>
            <input
              type="date"
              name="case_date"
              [(ngModel)]="formData.case_date"
              class="form-control"
              [class.error]="errors.case_date"
              [max]="todayStr"
            />
            <label *ngIf="errors.case_date" class="error">{{ errors.case_date }}</label>
          </p>

          <p><b>Handler:</b> <input type="text" class="form-control" [value]="formData.case_handler" readonly /></p>

          <p>
            <b>Status:</b>
            <select
              name="status"
              [(ngModel)]="formData.status"
              class="form-select"
              [class.error]="errors.status"
            >
              <option value="ACTIVE">ACTIVE</option>
              <option value="CLOSE">CLOSE</option>
            </select>
            <label *ngIf="errors.status" class="error">{{ errors.status }}</label>
          </p>
          <p class="mt-3">
            <button type="submit" class="btn btn-primary">Submit Update</button>
            <button type="button" class="btn btn-secondary ms-2" (click)="handleCancel()">
              Cancel
            </button>
          </p>
        </form>
      </ng-template>
    </div>
  </article>
</div>
