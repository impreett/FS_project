<div class="container mt-4" style="margin-bottom: 30px">
  <div *ngIf="loading">Loading form...</div>
  <div *ngIf="!loading && error" class="alert alert-danger">{{ error }}</div>

  <ng-container *ngIf="!loading && !error">
    <div
      class="p-4"
      style="background-color: #fff; border-radius: 8px; box-shadow: 0 0 10px #ccc; margin-bottom: 30px"
    >
      <h3 class="mb-4 text-center">Update Case</h3>
      <form (ngSubmit)="onSubmit()" novalidate>
        <div class="mb-3">
          <label class="form-label">Case Title</label>
          <input
            type="text"
            name="case_title"
            [(ngModel)]="formData.case_title"
            class="form-control"
            [class.is-invalid]="errors.case_title"
          />
          <div *ngIf="errors.case_title" class="invalid-feedback">{{ errors.case_title }}</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Case Type</label>
          <select
            name="case_type"
            [(ngModel)]="formData.case_type"
            class="form-select"
            [class.is-invalid]="errors.case_type"
          >
            <option value="">Select Case Type</option>
            <option value="Homicide (Murder)">Homicide (Murder)</option>
            <option value="Manslaughter">Manslaughter</option>
            <option value="Rape / Sexual Assault">Rape / Sexual Assault</option>
            <option value="Kidnapping / Abduction">Kidnapping / Abduction</option>
            <option value="Aggravated Assault">Aggravated Assault</option>
            <option value="Simple Assault / Battery">Simple Assault / Battery</option>
            <option value="Robbery">Robbery</option>
            <option value="Burglary / House Breaking">Burglary / House Breaking</option>
            <option value="Theft (Larceny)">Theft (Larceny)</option>
            <option value="Motor Vehicle Theft">Motor Vehicle Theft</option>
            <option value="Vandalism / Criminal Damage">Vandalism / Criminal Damage</option>
            <option value="Extortion / Blackmail">Extortion / Blackmail</option>
            <option value="Cybercrime / Hacking">Cybercrime / Hacking</option>
            <option value="Fraud / Cheating">Fraud / Cheating</option>
            <option value="Forgery / Counterfeiting">Forgery / Counterfeiting</option>
            <option value="Embezzlement / Breach of Trust">Embezzlement / Breach of Trust</option>
            <option value="Money Laundering">Money Laundering</option>
            <option value="Drug Offense (NDPS)">Drug Offense (NDPS)</option>
            <option value="Smuggling / Contraband">Smuggling / Contraband</option>
            <option value="Illegal Weapons">Illegal Weapons</option>
            <option value="Illegal Gambling">Illegal Gambling</option>
            <option value="Public Order / Rioting">Public Order / Rioting</option>
            <option value="Domestic Violence">Domestic Violence</option>
            <option value="Missing Person Report">Missing Person Report</option>
            <option value="Traffic Accident (Non-Fatal)">Traffic Accident (Non-Fatal)</option>
          </select>
          <div *ngIf="errors.case_type" class="invalid-feedback">{{ errors.case_type }}</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Case Description</label>
          <textarea
            name="case_description"
            [(ngModel)]="formData.case_description"
            class="form-control"
            rows="5"
            [class.is-invalid]="errors.case_description"
          ></textarea>
          <div *ngIf="errors.case_description" class="invalid-feedback">
            {{ errors.case_description }}
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">People Involved</label>
          <div *ngIf="errors.involvedPeople" class="text-danger small mb-2">
            {{ errors.involvedPeople }}
          </div>

          <div class="border rounded p-3 mb-3 people-involved-box">
            <div class="row g-3 people-roles-row">
              <div class="col-md-4 people-col-divider">
                <div class="p-2 h-100">
                  <div class="fw-semibold mb-2">Suspect</div>
                  <ul class="list-group list-group-flush people-role-list">
                    <li class="list-group-item text-muted small" *ngIf="suspectPeople.length === 0">
                      No suspect added.
                    </li>
                    <li
                      class="list-group-item d-flex justify-content-between align-items-center person-list-item"
                      *ngFor="let person of suspectPeople; trackBy: trackByIndex"
                    >
                      <div class="person-edit-entry">
                        <div class="person-edit-row">
                          <label class="person-edit-label">Name</label>
                          <input
                            type="text"
                            class="form-control form-control-sm"
                            maxlength="20"
                            [name]="'suspect_name_' + person.index"
                            [ngModel]="person.name"
                            (ngModelChange)="onPersonNameChange(person.index, $event)"
                          />
                          <label class="person-edit-label">Age</label>
                          <input
                            type="number"
                            class="form-control form-control-sm"
                            min="0"
                            max="120"
                            [name]="'suspect_age_' + person.index"
                            [ngModel]="person.age"
                            (ngModelChange)="onPersonAgeChange(person.index, $event)"
                          />
                        </div>
                      </div>
                      <button
                        type="button"
                        class="btn-close"
                        aria-label="Remove suspect"
                        (click)="removePerson(person.index)"
                      ></button>
                    </li>
                  </ul>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm mt-2"
                    (click)="addPersonForRole('suspects')"
                  >
                    + Add
                  </button>
                </div>
              </div>
              <div class="col-md-4 people-col-divider">
                <div class="p-2 h-100">
                  <div class="fw-semibold mb-2">Guilty</div>
                  <ul class="list-group list-group-flush people-role-list">
                    <li class="list-group-item text-muted small" *ngIf="guiltyPeople.length === 0">
                      No guilty person added.
                    </li>
                    <li
                      class="list-group-item d-flex justify-content-between align-items-center person-list-item"
                      *ngFor="let person of guiltyPeople; trackBy: trackByIndex"
                    >
                      <div class="person-edit-entry">
                        <div class="person-edit-row">
                          <label class="person-edit-label">Name</label>
                          <input
                            type="text"
                            class="form-control form-control-sm"
                            maxlength="20"
                            [name]="'guilty_name_' + person.index"
                            [ngModel]="person.name"
                            (ngModelChange)="onPersonNameChange(person.index, $event)"
                          />
                          <label class="person-edit-label">Age</label>
                          <input
                            type="number"
                            class="form-control form-control-sm"
                            min="0"
                            max="120"
                            [name]="'guilty_age_' + person.index"
                            [ngModel]="person.age"
                            (ngModelChange)="onPersonAgeChange(person.index, $event)"
                          />
                        </div>
                      </div>
                      <button
                        type="button"
                        class="btn-close"
                        aria-label="Remove guilty person"
                        (click)="removePerson(person.index)"
                      ></button>
                    </li>
                  </ul>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm mt-2"
                    (click)="addPersonForRole('guilty_name')"
                  >
                    + Add
                  </button>
                </div>
              </div>
              <div class="col-md-4">
                <div class="p-2 h-100">
                  <div class="fw-semibold mb-2">Victim</div>
                  <ul class="list-group list-group-flush people-role-list">
                    <li class="list-group-item text-muted small" *ngIf="victimPeople.length === 0">
                      No victim added.
                    </li>
                    <li
                      class="list-group-item d-flex justify-content-between align-items-center person-list-item"
                      *ngFor="let person of victimPeople; trackBy: trackByIndex"
                    >
                      <div class="person-edit-entry">
                        <div class="person-edit-row">
                          <label class="person-edit-label">Name</label>
                          <input
                            type="text"
                            class="form-control form-control-sm"
                            maxlength="20"
                            [name]="'victim_name_' + person.index"
                            [ngModel]="person.name"
                            (ngModelChange)="onPersonNameChange(person.index, $event)"
                          />
                          <label class="person-edit-label">Age</label>
                          <input
                            type="number"
                            class="form-control form-control-sm"
                            min="0"
                            max="120"
                            [name]="'victim_age_' + person.index"
                            [ngModel]="person.age"
                            (ngModelChange)="onPersonAgeChange(person.index, $event)"
                          />
                        </div>
                      </div>
                      <button
                        type="button"
                        class="btn-close"
                        aria-label="Remove victim"
                        (click)="removePerson(person.index)"
                      ></button>
                    </li>
                  </ul>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm mt-2"
                    (click)="addPersonForRole('victim')"
                  >
                    + Add
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Case Date</label>
          <input
            type="date"
            name="case_date"
            [(ngModel)]="formData.case_date"
            class="form-control"
            [class.is-invalid]="errors.case_date"
            [max]="todayStr"
          />
          <div *ngIf="errors.case_date" class="invalid-feedback">{{ errors.case_date }}</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Case Handler</label>
          <input type="text" class="form-control" [value]="formData.case_handler" readonly />
        </div>

        <div class="mb-3">
          <label class="form-label">Status</label>
          <select
            name="status"
            [(ngModel)]="formData.status"
            class="form-select"
            [class.is-invalid]="errors.status"
          >
            <option value="ACTIVE">ACTIVE</option>
            <option value="CLOSE">CLOSE</option>
          </select>
          <div *ngIf="errors.status" class="invalid-feedback">{{ errors.status }}</div>
        </div>
        <div class="mt-3">
          <button type="submit" class="btn btn-primary">Submit Update</button>
          <a routerLink="/update" class="btn btn-secondary ms-2">Cancel</a>
        </div>
      </form>
    </div>
  </ng-container>
</div>
