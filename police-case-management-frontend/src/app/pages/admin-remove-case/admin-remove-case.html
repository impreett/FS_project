<div class="container mt-4" style="margin-bottom: 30px">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
    <h2 class="mb-0">Remove Cases</h2>
    <div class="d-flex justify-content-end align-items-center gap-2" *ngIf="cases.length > 1">
      <span class="fw-semibold">Sort:</span>
      <div class="btn-group" role="group" aria-label="Sort cases">
        <button
          type="button"
          class="btn btn-outline-secondary btn-sm"
          [class.active]="sortOrder === 'latest'"
          (click)="setSortOrder('latest')"
        >
          Latest
        </button>
        <button
          type="button"
          class="btn btn-outline-secondary btn-sm"
          [class.active]="sortOrder === 'oldest'"
          (click)="setSortOrder('oldest')"
        >
          Oldest
        </button>
      </div>
    </div>
  </div>

  <div class="card card-body mb-4">
    <div class="row">
      <div class="col-md-4">
        <select
          class="form-select"
          [(ngModel)]="searchField"
          (ngModelChange)="onSearchFieldChange($event)"
          name="search_field"
        >
          <option value="for-all">All</option>
          <option value="case_title">Case Title</option>
          <option value="case_type">Case Type</option>
          <option value="case_description">Description</option>
          <option value="suspects">Suspects</option>
          <option value="victim">Victim</option>
          <option value="guilty_name">Guilty Name</option>
          <option value="case_date">Date</option>
          <option value="case_handler">Case Handler</option>
          <option value="status">Status</option>
          <option value="isApproved">Approval</option>
        </select>
      </div>
      <div class="col-md-8">
        <ng-container [ngSwitch]="searchField">
          <select
            *ngSwitchCase="'case_type'"
            class="form-select"
            [(ngModel)]="searchValue"
            (ngModelChange)="onSearchValueChange($event)"
            name="search_case_type"
          >
            <option value="">Select Case Type</option>
            <option *ngFor="let type of caseTypes" [value]="type">{{ type }}</option>
          </select>
          <select
            *ngSwitchCase="'case_handler'"
            class="form-select"
            [(ngModel)]="searchValue"
            (ngModelChange)="onSearchValueChange($event)"
            name="search_case_handler"
          >
            <option value="">Select Officer</option>
            <option *ngFor="let name of officers" [value]="name">{{ name }}</option>
          </select>
          <select
            *ngSwitchCase="'status'"
            class="form-select"
            [(ngModel)]="searchValue"
            (ngModelChange)="onSearchValueChange($event)"
            name="search_status"
          >
            <option value="">Select Status</option>
            <option value="ACTIVE">ACTIVE</option>
            <option value="CLOSE">CLOSE</option>
          </select>
          <select
            *ngSwitchCase="'isApproved'"
            class="form-select"
            [(ngModel)]="searchValue"
            (ngModelChange)="onSearchValueChange($event)"
            name="search_approval"
          >
            <option value="">-- Approval Status --</option>
            <option value="1">Approved</option>
            <option value="0">Pending</option>
          </select>
          <input
            *ngSwitchCase="'case_date'"
            type="date"
            class="form-control"
            [(ngModel)]="searchValue"
            (ngModelChange)="onSearchValueChange($event)"
            [max]="todayStr"
            name="search_case_date"
          />
          <input
            *ngSwitchDefault
            type="text"
            class="form-control"
            placeholder="Enter search value..."
            [(ngModel)]="searchValue"
            (ngModelChange)="onSearchValueChange($event)"
            name="search_value"
          />
        </ng-container>
      </div>
    </div>
  </div>

  <div *ngIf="message" class="alert alert-info">{{ message }}</div>
  <div *ngIf="loading">Loading cases...</div>
  <div *ngIf="!loading && groupedCases.length === 0" class="alert alert-info">No cases found.</div>
  <ng-container *ngIf="!loading">
    <ng-container *ngFor="let group of groupedCases">
      <h5 class="mb-3 text-secondary month-year-heading">{{ group.label }}</h5>
      <article *ngFor="let caseItem of group.items" class="card mb-3">
        <div class="card-body">
          <h3 class="card-title">
            <a [routerLink]="['/case', caseItem._id]">{{ caseItem.case_title }}</a>
          </h3>
          <p class="card-text mb-1"><b>Handler:</b> {{ caseItem.case_handler }}</p>
          <p class="card-text mb-1"><b>Date:</b> {{ caseItem.case_date | date: 'dd-MM-yyyy' }}</p>
          <p
            class="card-text mb-1 fw-bold"
            [class.text-success]="caseItem.isApproved"
            [class.text-danger]="!caseItem.isApproved"
          >
            <b>Approval:</b> {{ caseItem.isApproved ? 'Approved' : 'Pending' }}
          </p>
          <p class="card-text">{{ caseItem.case_description?.substring(0, 150) }}...</p>
          <button class="btn btn-danger mt-2" (click)="handleRemove(caseItem._id)">Remove Case</button>
        </div>
      </article>
    </ng-container>
  </ng-container>
</div>
