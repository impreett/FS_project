<div class="container mt-4">
  <h2 class="mb-4">Search Case</h2>
  <div class="card card-body mb-4">
    <div class="row">
      <div class="col-md-4">
        <select
          class="form-select"
          [(ngModel)]="searchField"
          (ngModelChange)="onSearchFieldChange($event)"
        >
          <option value="for-all">All</option>
          <option value="case_title">Case Title</option>
          <option value="case_type">Case Type</option>
          <option value="case_description">Description</option>
          <option value="suspects">Suspects</option>
          <option value="victim">Victim</option>
          <option value="guilty_name">Guilty Name</option>
          <option value="case_date">Date</option>
          <option value="case_handler">Case Handler</option>
          <option value="status">Status</option>
          <option *ngIf="user?.isAdmin" value="isApproved">Approval</option>
        </select>
      </div>
      <div class="col-md-8">
        <ng-container [ngSwitch]="searchField">
          <select
            *ngSwitchCase="'case_type'"
            class="form-select"
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchQueryChange($event)"
          >
            <option value="">Select Case Type</option>
            <option value="Homicide (Murder)">Homicide (Murder)</option>
            <option value="Manslaughter">Manslaughter</option>
            <option value="Rape / Sexual Assault">Rape / Sexual Assault</option>
            <option value="Kidnapping / Abduction">Kidnapping / Abduction</option>
            <option value="Aggravated Assault">Aggravated Assault</option>
            <option value="Simple Assault / Battery">Simple Assault / Battery</option>
            <option value="Robbery">Robbery</option>
            <option value="Burglary / House Breaking">Burglary / House Breaking</option>
            <option value="Theft (Larceny)">Theft (Larceny)</option>
            <option value="Motor Vehicle Theft">Motor Vehicle Theft</option>
            <option value="Vandalism / Criminal Damage">Vandalism / Criminal Damage</option>
            <option value="Extortion / Blackmail">Extortion / Blackmail</option>
            <option value="Cybercrime / Hacking">Cybercrime / Hacking</option>
            <option value="Fraud / Cheating">Fraud / Cheating</option>
            <option value="Forgery / Counterfeiting">Forgery / Counterfeiting</option>
            <option value="Embezzlement / Breach of Trust">Embezzlement / Breach of Trust</option>
            <option value="Money Laundering">Money Laundering</option>
            <option value="Drug Offense (NDPS)">Drug Offense (NDPS)</option>
            <option value="Smuggling / Contraband">Smuggling / Contraband</option>
            <option value="Illegal Weapons">Illegal Weapons</option>
            <option value="Illegal Gambling">Illegal Gambling</option>
            <option value="Public Order / Rioting">Public Order / Rioting</option>
            <option value="Domestic Violence">Domestic Violence</option>
            <option value="Missing Person Report">Missing Person Report</option>
            <option value="Traffic Accident (Non-Fatal)">Traffic Accident (Non-Fatal)</option>
          </select>
          <select
            *ngSwitchCase="'case_handler'"
            class="form-select"
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchQueryChange($event)"
          >
            <option value="">Select Officer</option>
            <option *ngFor="let name of officers" [value]="name">{{ name }}</option>
          </select>
          <select
            *ngSwitchCase="'status'"
            class="form-select"
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchQueryChange($event)"
          >
            <option value="">Select Status</option>
            <option value="ACTIVE">ACTIVE</option>
            <option value="CLOSE">CLOSE</option>
          </select>
          <select
            *ngSwitchCase="'isApproved'"
            class="form-select"
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchQueryChange($event)"
          >
            <option value="">-- Approval Status --</option>
            <option value="1">Approved</option>
            <option value="0">Pending</option>
          </select>
          <input
            *ngSwitchCase="'case_date'"
            type="date"
            class="form-control"
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchQueryChange($event)"
            [max]="todayStr"
          />
          <input
            *ngSwitchDefault
            type="text"
            class="form-control"
            placeholder="Enter search value..."
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchQueryChange($event)"
          />
        </ng-container>
      </div>
    </div>
  </div>

  <h4>Search Results</h4>
  <p *ngIf="loading">Loading...</p>

  <ng-container *ngIf="!loading">
    <ng-container *ngIf="cases.length > 0; else noCases">
      <article *ngFor="let caseItem of cases" class="case-details-card">
        <h2 class="mb-4" [innerHTML]="highlightText(caseItem.case_title, 'Untitled')"></h2>
        <p class="detail-row">
          <span class="detail-label"><b>Case ID:</b></span>
          <span class="detail-value" [innerHTML]="highlightText(caseItem._id, 'N/A')"></span>
        </p>
        <p class="detail-row">
          <span class="detail-label"><b>Type:</b></span>
          <span class="detail-value" [innerHTML]="highlightText(caseItem.case_type, 'N/A')"></span>
        </p>
        <p class="detail-row">
          <span class="detail-label"><b>Handler:</b></span>
          <span class="detail-value" [innerHTML]="highlightText(caseItem.case_handler, 'N/A')"></span>
        </p>
        <p class="detail-row">
          <span class="detail-label"><b>Victim:</b></span>
          <span class="detail-value people-lines" [style.--people-name-col]="peopleNameColumnWidthFor(caseItem)">
            <ng-container *ngIf="peopleForCaseField(caseItem, 'victim') as victimPeople">
              <ng-container *ngIf="victimPeople.length; else noVictim">
                <span class="person-line" *ngFor="let person of victimPeople">
                  <span class="person-name-part" [innerHTML]="highlightText('Name: ' + person.name)"></span>
                  <span class="person-age-part" [innerHTML]="highlightText('Age: ' + person.age)"></span>
                </span>
              </ng-container>
            </ng-container>
            <ng-template #noVictim>No victim added.</ng-template>
          </span>
        </p>
        <p class="detail-row">
          <span class="detail-label"><b>Suspects:</b></span>
          <span class="detail-value people-lines" [style.--people-name-col]="peopleNameColumnWidthFor(caseItem)">
            <ng-container *ngIf="peopleForCaseField(caseItem, 'suspects') as suspectPeople">
              <ng-container *ngIf="suspectPeople.length; else noSuspects">
                <span class="person-line" *ngFor="let person of suspectPeople">
                  <span class="person-name-part" [innerHTML]="highlightText('Name: ' + person.name)"></span>
                  <span class="person-age-part" [innerHTML]="highlightText('Age: ' + person.age)"></span>
                </span>
              </ng-container>
            </ng-container>
            <ng-template #noSuspects>No suspect added.</ng-template>
          </span>
        </p>
        <p class="detail-row">
          <span class="detail-label"><b>Guilty Name:</b></span>
          <span class="detail-value people-lines" [style.--people-name-col]="peopleNameColumnWidthFor(caseItem)">
            <ng-container *ngIf="peopleForCaseField(caseItem, 'guilty_name') as guiltyPeople">
              <ng-container *ngIf="guiltyPeople.length; else noGuilty">
                <span class="person-line" *ngFor="let person of guiltyPeople">
                  <span class="person-name-part" [innerHTML]="highlightText('Name: ' + person.name)"></span>
                  <span class="person-age-part" [innerHTML]="highlightText('Age: ' + person.age)"></span>
                </span>
              </ng-container>
            </ng-container>
            <ng-template #noGuilty>No guilty person added.</ng-template>
          </span>
        </p>
        <p class="detail-row">
          <span class="detail-label"><b>Date:</b></span>
          <span class="detail-value" [innerHTML]="highlightText(displayDate(caseItem.case_date), 'N/A')"></span>
        </p>
        <p class="detail-row">
          <span class="detail-label"><b>Status:</b></span>
          <span class="detail-value" [innerHTML]="highlightText(caseItem.status, 'N/A')"></span>
        </p>
        <p class="detail-row" *ngIf="user?.isAdmin">
          <span class="detail-label"><b>Approval:</b></span>
          <span
            class="detail-value"
            [class.text-success]="caseItem.isApproved"
            [class.text-danger]="!caseItem.isApproved"
            [innerHTML]="highlightText(displayApproval(caseItem.isApproved), 'N/A')"
          ></span>
        </p>
        <p class="desc-box">
          <b>Description:</b><br />
          <span style="white-space: pre-wrap" [innerHTML]="highlightText(caseItem.case_description)"></span>
        </p>
      </article>
    </ng-container>
    <ng-template #noCases>
      <div class="alert alert-info">No cases found.</div>
    </ng-template>
  </ng-container>
</div>
